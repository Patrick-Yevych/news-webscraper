<!DOCTYPE html>
<html>
<head>
<style>
    body {
        font-family: "Courier New", "Times New Roman";
    }
    th, td {

        border-bottom: 1px solid #ddd;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    tr:hover {
        background-color:#dcdcdc;
    }
    .inline {
        display: inline;
    }
    .link-button {
        background: none;
        border: none;
        color: blue;
        text-decoration: underline;
        cursor: pointer;
        font-size: 1em;
        font-family: serif;
        padding-right:5px;
    }
    .form-popup {
        display: none;
        background-color: bisque;
        width:60%;
    }
    .form-popup-btns {
        padding-left:1px;
    }
</style>
<script>
    var scraper_toggle_id = 0;

    function new_scraper_open() {
        document.getElementById("new_scraper_form").style.display = "block";
    }
    function new_scraper_close() {
        document.getElementById("new_scraper_form").style.display = "none";
    }
    function set_toggle_visibility(metric, id) {
        if (metric == "manual") {
            document.getElementById(id).style.display = "none";
        }
    }
</script>
</head>
<body>
    <h2><a href="results">Results</a> | <a href="scrapers">Scrapers</a></h2>

    [<button class="link-button" onclick="new_scraper_open()">new/edit scraper</button>]
    <br><br>
    <div class="form-popup" id="new_scraper_form">
        <form method="POST" action="scrapers" class="form-container">

        <input type="hidden" name="action_type" value="create_scraper">

        <label for="search_query"><b>search_query:</b></label>
        <input type="text" placeholder="Enter search query..." name="search_query" required>

        <label for="engine"><b>engine:</b></label>
        <select name="engine">
            <option value="google">Google</option>
        </select>

        <label for="max_pages"><b>max_pages:</b></label>
        <input type="text" placeholder="Default: 100, Max: 1000" name="max_pages" required>

        <label for="page_step"><b>page_step:</b></label>
        <input type="text" placeholder="Default: 1" name="page_step" required>

        <label for="per_page"><b>per_page:</b></label>
        <input type="text" placeholder="Default: 10, Max: 100" name="per_page" required>

        <label for="run_interval_value"><b>autorun:</b> every </label>
        <input type="text" placeholder="" name="run_interval_value">
        <select name="run_interval_metric">
            <option value="manual">disabled</option>
            <option value="minute">minute(s)</option>
            <option value="hour">hour(s)</option>
            <option value="day">day(s)</option>
            <option value="week">week(s)</option>
            <option value="month">month(s)</option>
            <option value="year">year(s)</option>
        </select>

        <div class="form-popup-btns" id="popup-btns">
            [<button type="submit" class="link-button">create</button>]
            [<button type="button" class="link-button" onclick="new_scraper_close()">close</button>]
        </div>
        </form>
    </div>
    <br>
    <table style="width:60%">
        <thead>
        <tr style="background-color:burlywood;">
            <th>search_query</th>
            <th>engine</th>
            <th>max_pages</th>
            <th>page_step</th>
            <th>per_page</th>
            <th>autorun_value</th>
            <th>autorun_metric</th>
            <th>last_run</th>
            <th>actions</th>
        </tr>
        </thead>
        <tbody>
        {% for item in data %}
        <tr>
            <td>{{item['search_query']}}</td>
            <td>{{item['engine']}}</td>
            <td>{{item['max_pages']}}</td>
            <td>{{item['page_step']}}</td>
            <td>{{item['per_page']}}</td>
            <td>{{item['run_interval_value']}}</td>
            <td>{{item['run_interval_metric']}}</td>
            <td>{{item['last_run']}}</td>
            <td> 
            <form method="POST" action="scrapers" class="inline">
                <input type="hidden" name="action_type" value="run_scraper">
                <input type="hidden" name="search_query" value="{{item['search_query']}}">
                <input type="hidden" name="engine" value="{{item['engine']}}">
                <input type="hidden" name="max_pages" value="{{item['max_pages']}}">
                <input type="hidden" name="page_step" value="{{item['page_step']}}">
                <input type="hidden" name="per_page" value="{{item['per_page']}}">
                [<button type="submit" name="run_btn" value="run_req" class="link-button">run</button>]
            </form>

            <form method="POST" id="toggle_scraper_form" action="scrapers" class="inline">
                <input type="hidden" name="action_type" value="toggle_scraper">
                <input type="hidden" name="search_query" value="{{item['search_query']}}">
                <input type="hidden" name="engine" value="{{item['engine']}}">
                [<button type="submit" name="toggle_btn" value="toggle_req" class="link-button">{{item['toggle_text']}}</button>]
            </form>
            
            <form method="POST" action="scrapers" class="inline">
                <input type="hidden" name="action_type" value="delete_scraper">
                <input type="hidden" name="search_query" value="{{item['search_query']}}">
                <input type="hidden" name="engine" value="{{item['engine']}}">
                [<button type="submit" name="delete_btn" value="delete_req" class="link-button">delete</button>]
            </form>

            <script>
                document.getElementById("toggle_scraper_form").setAttribute("id", scraper_toggle_id);
                set_toggle_visibility("{{item['run_interval_metric']}}", scraper_toggle_id)
                scraper_toggle_id += 1;
            </script>

            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</body>

</html>